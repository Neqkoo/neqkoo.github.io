<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AES-256 Text Locker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#dcdcdc;font:14px Tahoma,Verdana,Arial,sans-serif;color:#111}
#w{width:760px;margin:40px auto;background:#fff;border:1px solid #999;box-shadow:0 0 8px rgba(0,0,0,.25)}
#h{padding:12px 16px;background:#f2f2f2;border-bottom:1px solid #cfcfcf;font-size:20px;font-weight:bold;letter-spacing:.5px;text-shadow:0 1px 0 #fff}
#c{padding:18px}
label{display:block;margin:10px 0 6px;font-weight:bold}
small{color:#666;font-weight:normal}
input[type=text],textarea{width:100%;box-sizing:border-box;border:1px solid #666;background:#fafafa;padding:8px;font-family:"Courier New",monospace;border-radius:2px}
textarea{height:220px;resize:vertical}
.row{display:flex;gap:10px;align-items:center}
.row input[type=text]{flex:1}
.btns{margin-top:14px;display:flex;gap:10px}
button{border:1px solid #666;padding:8px 14px;border-radius:2px;background:linear-gradient(#eee,#cfcfcf);cursor:pointer;font-weight:bold}
button:active{transform:translateY(1px)}
#kbase{margin-top:6px;font-size:12px;color:#333;background:#f8f8f8;border:1px dashed #bbb;padding:6px;word-break:break-all}
footer{padding:10px 16px;border-top:1px solid #cfcfcf;background:#f7f7f7;color:#555;font-size:12px;text-align:center}
</style>
</head>
<body>
<div id="w">
<div id="h">AES-256 Text Locker</div>
<div id="c">
<label>Text / Encrypted Text</label>
<textarea id="io"></textarea>
<label>Key <small>(will auto-normalize to 256-bit and Base64)</small></label>
<div class="row">
<input id="key" type="text" placeholder="Type a passphrase or paste a Base64 key">
<button id="gen">Random Key</button>
</div>
<div id="kbase"></div>
<div class="btns">
<button id="enc">Encrypt</button>
<button id="dec">Decrypt</button>
</div>
</div>
<footer>Raw 2008 vibes. AES-GCM with 256-bit keys. Output = Base64(IV||Ciphertext).</footer>
</div>
<script>
function s2u8(s){return new TextEncoder().encode(s)}
function u82s(u){return new TextDecoder().decode(u)}
function b64norm(s){s=(s||"").trim().replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/");var m=s.length%4;if(m===2)s+="==";else if(m===3)s+="=";else if(m===1)s+="===";return s}
function b642u8(s){s=b64norm(s);var bin=atob(s);var u=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)u[i]=bin.charCodeAt(i);return u}
function u82b64(u){var bin="";for(var i=0;i<u.length;i++)bin+=String.fromCharCode(u[i]);return btoa(bin)}
async function sha256(u){return new Uint8Array(await crypto.subtle.digest("SHA-256",u))}
async function normalizeKeyInput(raw){
var trimmed=(raw||"").trim();var asB64=null;
try{asB64=b642u8(trimmed)}catch(e){asB64=null}
var bytes=asB64&&asB64.length?asB64:s2u8(trimmed);
if(bytes.length===32){}else if(bytes.length<32){var p=new Uint8Array(32);p.set(bytes);bytes=p}else{bytes=await sha256(bytes)}
var outB64=u82b64(bytes);
document.getElementById("kbase").textContent="Normalized Base64 Key: "+outB64;
return {bytes:bytes,b64:outB64}
}
async function getCryptoKey(){
var k=document.getElementById("key").value;var norm=await normalizeKeyInput(k);document.getElementById("key").value=norm.b64;
return await crypto.subtle.importKey("raw",norm.bytes,{name:"AES-GCM",length:256},false,["encrypt","decrypt"])
}
function join(a,b){var out=new Uint8Array(a.length+b.length);out.set(a,0);out.set(b,a.length);return out}
async function encrypt(){
try{
var key=await getCryptoKey();var iv=new Uint8Array(12);crypto.getRandomValues(iv);
var data=s2u8(document.getElementById("io").value);
var ct=new Uint8Array(await crypto.subtle.encrypt({name:"AES-GCM",iv:iv,tagLength:128},key,data));
var out=u82b64(join(iv,ct));
document.getElementById("io").value=out
}catch(e){alert("Encrypt failed")}
}
async function decrypt(){
try{
var key=await getCryptoKey();var combo=b642u8(document.getElementById("io").value);
if(combo.length<13)throw new Error("bad input");
var iv=combo.slice(0,12);var ct=combo.slice(12);
var pt=new Uint8Array(await crypto.subtle.decrypt({name:"AES-GCM",iv:iv,tagLength:128},key,ct));
document.getElementById("io").value=u82s(pt)
}catch(e){alert("Decrypt failed")}
}
document.getElementById("enc").addEventListener("click",encrypt);
document.getElementById("dec").addEventListener("click",decrypt);
document.getElementById("gen").addEventListener("click",async function(){
var r=new Uint8Array(32);crypto.getRandomValues(r);var b=u82b64(r);document.getElementById("key").value=b;await normalizeKeyInput(b)
});
normalizeKeyInput("");
</script>
</body>
</html>
